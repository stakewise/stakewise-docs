---
title: How Vaults Work
sidebar_position: 1
description: "Learn how Vaults register validators, distribute rewards, and process withdrawals"
---

```mdx-code-block
import Tooltip from '@site/src/components/Tooltip/Tooltip';
```

# How Vaults Work

## Validator registration

Vaults collect user deposits and manage the validator lifecycle through smart contracts.
When a Vault accumulates enough assets ‚Äî 32 ETH on Ethereum or 1 GNO on Gnosis ‚Äî the system initiates validator registration.

<Tooltip content={<><strong>Vault operator(s)</strong> <br /> Entities or individuals who run validators for a Vault. They operate the infrastructure and run the <a href="https://github.com/stakewise/v3-operator" className="tooltip-link">operator service software ‚Üó</a> that automates essential Vault management tasks ‚Äî such as validator registration, consolidations, and withdrawals.</>}>The Vault operator</Tooltip>
runs specialized software (the [operator ‚Üó](https://github.com/stakewise/v3-operator) service) alongside their Ethereum [consensus ‚Üí](../../operator/Prerequisites#consensus-client) and [execution ‚Üí](../../operator/Prerequisites#execution-client) clients
that monitor deposit levels and handle the technical validator setup process.

When sufficient funds are available, this service submits validator registration requests to the StakeWise [Oracle network ‚Üí](../oracles/intro).
The Operator Service must receive 8 out of 11 approvals from Oracles to register a validator for the Vault.
The service automatically generates deposit data during registration, eliminating the need for pre-uploaded deposit data files. Once approved, validators enter the Beacon Chain's activation queue. [Network ‚Üó](https://www.validatorqueue.com/) conditions determine how quickly they begin earning staking rewards.

Vaults support two types of validators: `0x01` or `0x02`<sup><a href="#fn-1" id="fnref-1">1</a></sup>.
The default type is `0x02`. When registering validators, the Operator Service prioritizes funding existing `0x02` validators by selecting those with the highest current balance and topping them up to 2048 ETH before creating new validators.

The technical process for registering validators involves coordination between the [Operator Service ‚Üí](../../operator/intro) and the [Oracle network ‚Üí](../oracles/intro):

:::custom-notes[Validator Registration Process]
The Operator Service performs the following steps:
1. Check if the Vault has enough assets to register a validator (e.g., 32 ETH for Ethereum)
2. Get the next free validator key from the used keystore
3. Obtain the BLS signature for exit messages<sup><a href="#fn-2" id="fnref-2" style={{textDecoration: 'none'}}>2</a></sup> using local keystores or a [remote signer ‚Üí](../../operator/alternative-key-management/remote-signer)
4. Share the validator's exit signature with StakeWise Oracles:
    - Split the BLS signature<sup><a href="#fn-3" id="fnref-3" style={{textDecoration: 'none'}}>3</a></sup> using [Shamir's Secret Sharing ‚Üó](https://en.wikipedia.org/wiki/Shamir%27s_secret_sharing) (number of shares = number of Oracles)
    - Encrypt each signature share with the corresponding Oracle's public key
    - Send the encrypted shares to all Oracles and receive registration signatures in return
5. Submit a transaction to the Vault contract to register the validator.
:::

Vaults can have several node operators running validators and support <Tooltip content={<><strong>Distributed Validator Technology</strong> <br /> A solution designed to overcome a single-operator trust problem by splitting a validator's private key among multiple independent operators. <br /> More on DVT - <a href="https://ethereum.org/en/staking/dvt/" className="tooltip-link">ethereum.org ‚Üó</a></>}>Distributed Validator Technology</Tooltip> (DVT) to increase redundancy.

:::custom-notes[Deep Dive]
For more details on how Oracles handle the validator registration approval process, see [Validator Registration Approval ‚Üí](../oracles/oracle-duties#validator-registration-approval).
:::

## Reward Distribution

Once validators are registered and active, they earn:
- **Consensus layer rewards**: Block proposals, attestations, and sync committee participation
- **Execution layer rewards**: <Tooltip content={<><strong>MEV (Maximum Extractable Value)</strong> <br /> Additional profits that validators can earn when proposing blocks by reordering, including, or excluding transactions within a block. MEV opportunities include arbitrage, liquidations, and sandwich attacks.</>}>MEV</Tooltip>, transaction fees, and block tips

Validators receive rewards only between their activation and exit epochs.

The Vault initially holds rewards as liquid ETH until there is enough to register additional validators.

After the <Tooltip content={<><strong>Pectra</strong> <br /> The Prague/Electra (Pectra) hardfork activated on 07-May-2025 at epoch 364032, introducing significant changes to both execution and consensus layers. Key features include variable validator effective balance (32-2048 ETH via EIP-7251), execution layer triggerable exits (EIP-7002), improved deposit processing (EIP-6110), BLS12-381 precompile (EIP-2537), programmable EOAs (EIP-7702), and increased blob throughput (EIP-7691), establishing a base layer for future scaling efforts.</>}>[Pectra ‚Üó](https://ethereum.org/en/roadmap/pectra/)</Tooltip> upgrade,
<Tooltip content={<><strong>EIP-7251</strong> <br /> Ethereum Improvement Proposal that increases the maximum effective balance of validators from 32 ETH to 2048 ETH, enabling validator consolidation and partial withdrawals.</>}>[EIP-7251 ‚Üó](https://eips.ethereum.org/EIPS/eip-7251)</Tooltip> allows Vaults to merge multiple 32 ETH validators into fewer `0x02` compound validators with higher effective balances, thus
improving efficiency and reducing infrastructure overhead, while allowing partial withdrawals of rewards above 32 ETH.
Each Vault decides whether to:

- Reinvest accumulated rewards into additional staking via consolidation, or

- Keep rewards as <Tooltip content={<><strong>Unbounded ETH</strong> <br /> ETH that is not locked in validators (32 ETH increments). This includes excess deposits, staking rewards, and MEV that have not been allocated to new validators yet.</>}>unbounded ETH</Tooltip>
within the Vault for greater liquidity.

Rewards are calculated off-chain by the StakeWise Oracle Network.

:::custom-notes[Deep Dive]
For detailed information about the reward distribution process, see [*Oracles*: Reward Distribution ‚Üí](../oracles/oracle-duties#reward-distribution).
:::

## Withdrawals

<div style={{textAlign: 'center', margin: '2rem 0'}}>
  <pre style={{
    display: 'inline-block',
    textAlign: 'left',
    background: 'var(--ifm-color-emphasis-200)',
    color: 'var(--ifm-color-primary)',
    padding: '2rem',
    borderRadius: '12px',
    fontSize: '14px',
    fontFamily: 'Monaco, monospace',
    boxShadow: '0 10px 30px rgba(1,137,112,0.2)',
    lineHeight: '1.8'
  }}>
    <strong style={{fontSize: '16px', borderBottom: '2px solid #018970', paddingBottom: '0.5rem', display: 'inline-block', marginBottom: '1rem'}}>üí∞ Withdrawal Process</strong>

    üîç Check Queued Assets &rarr; üéØ Withdraw Excess &rarr; üí° Partial Withdrawals
                                            ‚îÇ
                                            &rarr; üö™ Full Validator Exits
                                            ‚îÇ
                                            &rarr; ‚è∞ Oracle Fallback (24h)
  </pre>
</div>

Users can mint osTokens for instant liquidity or withdraw. When users choose to unstake, they enter the Vault's **exit queue** and receive a **position ticket** that tracks their place in line.
As ETH becomes available to the Vault, users can claim what is available.
If only part of the requested amount is available, they can claim that portion immediately and receive an updated ticket for the remainder.

Partial withdrawals for `0x02` compound validators are now supported. They are significantly faster and more efficient than full validator exits, which can now also be triggered from the execution layer via [EIP-7002](https://eips.ethereum.org/EIPS/eip-7002)<sup><a href="#fn-4" id="fnref-4">4</a></sup>.
The withdrawal fulfillment process is automated by the [Operator Service ‚Üí](../../operator/intro), which manages validator exits and partial withdrawals among other responsibilities to ensure timely processing of the exit queue.

:::custom-info[Processing Time]
On mainnet, partial withdrawals typically complete faster (‚âà27‚Äì28 hours), while full exits can take **up to one month** to finalize.
:::

### Validator Exits

The Operator Service automatically triggers validator exits when required.
By default, the Operator Service checks every **12 hours** (configurable via `WITHDRAWALS_INTERVAL`) to process queued withdrawal requests.
If partial withdrawals are not possible, the Operator Service initiates **full exits**.
If the Operator Service fails to exit validators within **24 hours**, **Oracles will step in** and perform the exits instead.

The process is as follows:

1. **Regular check**. Every 12 hours, the Vault checks for pending positions in the exit queue and first attempts to satisfy them with ETH that is already available to the Vault ‚Äî i.e., unbonded ETH (deposits + unallocated rewards) and harvested MEV.
2. **Initiate exits if needed**. If available ETH is insufficient, the Operator Service initiates validator exits to free up the remaining amount. If there are `0x02` validators in the vault, the operator service will trigger partial withdrawals from these validators. If the required amount is larger than what is available from partial withdrawals, the operator service will trigger validator exits through a vault contract call.
3. **Oracle enforcement of exits**. If the Operator Service does not initiate partial or full withdrawals, the Oracle network will automatically execute a full withdrawal after 24 hours using the exit signatures they have received during validator registration.

The exit queue advances whenever the Vault **syncs state** ‚Äî both on **user actions**
(entering the queue, deposits/withdrawals) and on the **Operator Service-driven syncs**<sup><a href="#fn-5" id="fnref-5">5</a></sup>.
Throughout the process, user assets are safe in the Vault's smart contracts and are never controlled by any third party.

Exit processing time depends on the Ethereum network conditions.
Staked assets continue earning rewards until validators complete the exit.
Once a validator fully exits, its balance is [swept ‚Üó](https://ethereum.org/en/staking/withdrawals/#validator-sweeping) to the Vault and becomes claimable by users according to their ticket number.

## osToken

osTokens (`osETH` or `osGNO`) are ERC-20 tokens that users can mint from any Vault using their shares as backing (aka collateral), providing liquidity without unstaking. osToken can be traded or used in DeFi while the underlying stake continues earning rewards.

The system keeps more staked assets backing each osToken than the token is worth. This safety buffer protects users and keeps the system stable. The Vault's Loan-to-Value ratio determines how much users can mint ‚Äî this ranges from standard ratios around 90% up to 99.99% for DAO-approved Vaults<sup><a href="#fn-6" id="fnref-6">6</a></sup>.

:::custom-notes[Deep Dive]
For more details on how osToken works, see [osToken ‚Üí](../ostoken/intro).
:::

<div id="fn-1" style={{fontSize: '0.85em', color: 'var(--ifm-color-content-secondary)', marginTop: '2rem', listStyle: 'none', fontFamily: 'Fragment Mono, ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, Liberation Mono, Courier New, monospace'}}>
  <span>1.</span> `0x01` and `0x02` refer to withdrawal credential types that determine validator capabilities:
  `0x01` validators (Type 1) use the current 32 ETH limit with automatic sweeps of excess balance, while
  `0x02` validators (Type 2) support higher effective balances up to 2048 ETH with compounding rewards and partial withdrawals.
  Converting from `0x01` to `0x02` is irreversible.
  By default, the `0x02` validators are registered. To register `0x01` validators, add the flag `--validators-type=0x01`.
  <a href="#fnref-1" style={{color: 'var(--ifm-color-content-secondary)', textDecoration: 'none'}}>‚Ü©</a>
</div>

<div id="fn-2" style={{fontSize: '0.85em', color: 'var(--ifm-color-content-secondary)', marginTop: '2rem', listStyle: 'none', fontFamily: 'Fragment Mono, ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, Liberation Mono, Courier New, monospace'}}>
  <span>2.</span>
  Validators in Ethereum use two sets of BLS keys: <strong>validator keys (hot)</strong> and <strong>withdrawal keys (cold)</strong>. Validator keys sign attestations, blocks, and exits (e.g., `SignedVoluntaryExit`), while withdrawal keys secure the eventual withdrawal of stake and rewards.
  <a href="#fnref-2" style={{color: 'var(--ifm-color-content-secondary)', textDecoration: 'none'}}>‚Ü©</a>
</div>

<div id="fn-3" style={{fontSize: '0.85em', color: 'var(--ifm-color-content-secondary)', marginTop: '2rem', listStyle: 'none', fontFamily: 'Fragment Mono, ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, Liberation Mono, Courier New, monospace'}}>
  <span>3.</span>
  BLS (Boneh‚ÄìLynn‚ÄìShacham) is a digital signature scheme introduced in 2001. It relies on the hardness of the <a href="https://www.iacr.org/archive/asiacrypt2001/22480516.pdf" className="tooltip-link">Computational Diffie‚ÄìHellman (CDH) problem</a> to prevent forgery. A user selects a secret key and derives the corresponding public key on an elliptic curve. To sign, the message is hashed to a curve point and multiplied by the secret key, producing the signature. Verification uses a bilinear pairing to confirm validity. Learn more about BLS signatures <a href="https://www.iacr.org/archive/asiacrypt2001/22480516.pdf" className="tooltip-link">here</a>.
  <a href="#fnref-3" style={{color: 'var(--ifm-color-content-secondary)', textDecoration: 'none'}}>‚Ü©</a>
</div>


<div id="fn-4" style={{fontSize: '0.85em', color: 'var(--ifm-color-content-secondary)', marginTop: '2rem', listStyle: 'none', fontFamily: 'Fragment Mono, ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, Liberation Mono, Courier New, monospace'}}>
  <span>4.</span> You can disable partial withdrawals if you prefer to rely solely on full exits. Use the `--disable-withdrawals` flag when starting the Operator Service:<br/>`./operator start --vault=0x3320a68 --disable-withdrawals` <br/> In this case, funds will be withdrawn via full exits using Oracles. <a href="#fnref-4" style={{color: 'var(--ifm-color-content-secondary)', textDecoration: 'none'}}>‚Ü©</a>
</div>

<div id="fn-5" style={{fontSize: '0.85em', color: 'var(--ifm-color-content-secondary)', marginTop: '2rem', listStyle: 'none', fontFamily: 'Fragment Mono, ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, Liberation Mono, Courier New, monospace'}}>
  <span>5.</span> Vault state can also be updated by the Vault operator by passing the `--harvest-vault` flag to the Operator Service `start` command. Harvest occurs every **12 hours** and the gas fees are paid by the hot wallet linked to the Operator Service. <a href="#fnref-5" style={{color: 'var(--ifm-color-content-secondary)', textDecoration: 'none'}}>‚Ü©</a>
</div>

<div id="fn-6" style={{fontSize: '0.85em', color: 'var(--ifm-color-content-secondary)', marginTop: '2rem', listStyle: 'none', fontFamily: 'Fragment Mono, ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, Liberation Mono, Courier New, monospace'}}>
  <span>6.</span> To qualify for the higher LTV, Vaults must meet strict DAO-defined criteria, including: Minimum stake: ‚â• 10k ETH (for osETH) or ‚â• 5k GNO (for osGNO); Vault fee ‚â§ 5% for ETH, ‚â§ 15% for GNO; Consistently above-median performance; Running the latest Vault version; Vault Operator's locked SWISE bond: 5M for ETH, 1M for GNO. <a href="#fnref-6" style={{color: 'var(--ifm-color-content-secondary)', textDecoration: 'none'}}>‚Ü©</a>
</div>
